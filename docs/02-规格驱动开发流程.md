# 规格驱动开发流程（Spec-Driven Development）

> 参考资料：[GitHub Spec Kit](https://github.com/github/spec-kit)

本项目使用 Specify CLI 推动规格驱动开发流程，确保从架构规范到实现的所有环节均可追溯。以下约定覆盖环境准备、流程步骤与与本仓库目录的映射关系。

## 1. 环境准备

1. 安装 [uv](https://docs.astral.sh/uv/latest/) 及 Python 3.11+。
2. 按需安装 Specify CLI：
   ```bash
   uv tool install specify-cli --from git+https://github.com/github/spec-kit.git
   ```
3. 验证依赖：
   ```bash
   specify check
   ```
4. 若需一次性执行，可使用 `uvx --from ... specify` 临时运行。

## 2. 工作区初始化

在仓库根目录执行以下命令，将 Spec Kit 模板引入当前项目（不会覆盖现有文档）：

```bash
specify init --here --ai copilot --ignore-agent-tools
```

- `--here`：在当前目录生成 `.specify/` 等元数据。
- `--ai copilot`：启用 Codex CLI 集成，确保 VS Code / Copilot Agent 可调用 `/speckit.*` 命令。
- `--ignore-agent-tools`：跳过对其他 AI 代理的检测，减少初始化阻塞。

> 如需强制覆盖 `.specify/` 目录，可加 `--force`。请先备份本地自定义模板。

## 3. 流程步骤

1. **制定宪章**：
   - 运行 `/speckit.constitution`，生成或更新 `.specify/memory/constitution.md`。
   - 同步维护 `docs/constitution.md`，确保文字描述一致。
2. **撰写规格**：
   - 在功能分支下执行 `/speckit.specify`，生成 `.specify/specs/<feature>/spec.md` 草稿。
   - 填充业务背景、角色、用户旅程、验收标准，并补充跨文档引用。
3. **需求澄清**：
   - 使用 `/speckit.clarify` 收集未决问题，结果写入 `spec.md` 的「澄清记录」段落。
4. **制定计划**：
   - 运行 `/speckit.plan` 明确技术栈、模块边界、数据流与测试策略。
   - 输出同步到 `.specify/specs/<feature>/plan.md`、`research.md` 等文件；确保覆盖性能与可观测性要求。
5. **拆解任务**：
   - 调用 `/speckit.tasks` 生成 `.specify/specs/<feature>/tasks.md`，标注依赖、并行任务（用 `[P]`）与测试顺序。
6. **实施阶段**：
   - `/speckit.implement` 根据任务清单执行，实现时引用计划与契约。
   - 实施过程中新增的脚本或配置需回写到 `plan.md` / `tasks.md` 的更新记录。

## 4. 目录映射

| 工件 | Canonical 位置 | 备注 |
| ---- | -------------- | ---- |
| 宪章 | `.specify/memory/constitution.md`（同步 `docs/constitution.md`） | 审批后需双向同步。 |
| 功能规格 | `.specify/specs/<feature>/spec.md` | 规格唯一存放地。 |
| 实施计划 | `.specify/specs/<feature>/plan.md` | 包含架构决策、里程碑、测试策略。 |
| 任务清单 | `.specify/specs/<feature>/tasks.md` | `/speckit.implement` 的执行依据。 |
| 契约资料 | `.specify/specs/<feature>/contracts/`、`.specify/specs/shared/` | JSON Schema、OpenAPI、事件定义。 |

## 5. 分支与命名规范

- 每个功能使用 `feature/<feature-id>-<slug>` 命名，例如 `feature/001-business-system`。
- 提交信息需引用规格章节或任务编号，如 `feat(001-plan): 完成租户上下文拦截器实现`。
- 合并前需确认 `spec.md`、`plan.md`、`tasks.md` 的复选框与状态同步更新。

## 6. 更新记录

- 2025-10-26：创建流程文档，定义 Specify CLI 安装命令、工作流步骤与目录映射关系。

# 规格驱动开发快速上手（Spec-Driven Development）

> 版本：v0.1（2025-10-26）

本指南面向首次参与本项目的开发、测试与产品同学，帮助你用统一方法编写与使用“规格（Spec）”，并借助 Specify CLI（Spec Kit）维持“规格—计划—任务—契约—实现”的一致性与可追溯性。

## 1. 核心理念（为什么）
- 单一事实来源：`.specify/specs/` 目录中的规格、计划、任务与契约是项目决策的唯一依据。
- 可追溯：每段代码、每条脚本、每个测试都能追溯到某条规格或任务。
- 先契约后实现：先定义 API/事件/数据结构（JSON Schema 等），再编码与联调。

## 2. 目录结构（放在哪里）
- `.specify/specs/<feature>/spec.md`：需求规格（范围、角色、用例、约束、错误码…）
- `.specify/specs/<feature>/plan.md`：实施计划（里程碑、成功指标、风险、验收）
- `.specify/specs/<feature>/tasks.md`：任务分解（勾选项，完成后同步记录）
- `.specify/specs/<feature>/contracts/`：契约（REST/WS/事件/数据模型定义）
- `.specify/specs/shared/schemas/`：共享 JSON Schema（如 RequestEnvelope、Table/ChartDescriptor 等）

## 3. 流程（怎么做）
1) 编写/更新规格（Spec）
- 与产品/数据方澄清需求，使用 `[NEEDS CLARIFICATION]` 标注未决项。
- 输出边界、非功能、错误码，连同样例请求/响应。

2) 制定实施计划（Plan）
- 里程碑（M1/M2…）、成功指标（例如 p95 延迟、准召平衡）、风险与回滚策略。
- 明确“完成定义（DoD）”：测试覆盖、演示脚本、文档更新。

3) 任务拆分（Tasks）
- 将实现步骤拆成可交付的小清单（PR 级别），每完成一项就勾选并在“更新记录”记要点。

4) 契约先行（Contracts）
- 优先定义或补全 JSON Schema 与接口说明（见 `shared/schemas/`）。
- 通过类型生成器产出 TS/Java/Python 类型后再编码（后续流水线会接入）。

5) 校验一致性（Check）
- 使用 Specify CLI 对规格产物进行校验与同步（初始化后，可运行 `specify check`）。

## 4. 开发者最常见问题（FAQ）
- Schema 放哪？
  - 放在 `.specify/specs/shared/schemas/`，目前已包含：
    - `request-envelope.json`、`business-request.json`、`sql-request.json`、`insight-payload.json`
    - `table-descriptor.json`、`chart-descriptor.json`（新加，供前端渲染）
- 我如何引用 Schema？
  - 在契约或示例中以 `$ref` 或在文档中链接相对路径；VS Code 已配置 schema 关联（见工作区配置）。
- CLI 没安装？
  - 可由团队统一安装后执行 `specify init --here` 与 `specify check`（安装方式见团队内分发说明）。

## 5. 成功标准（如何算完成）
- 每个里程碑具备：
  - 规格/计划/任务文档更新到位，且可被审阅。
  - 契约（JSON Schema/接口）稳定，生成的类型成功编译并被测试引用。
  - 自动化测试（单测/契约测/集成测）通过，演示脚本可复现。

## 6. 参考与后续
- 宪章：`docs/constitution.md`（说明 `.specify` 为唯一规格来源）
- 规格示例：`.specify/specs/001-business-system/`、`.specify/specs/002-intelligent-querying/`
- 共享 Schema：`.specify/specs/shared/schemas/`

> 备注：本指南为轻量“上手版”。随着流水线接入 Specify CLI 的自动校验与类型生成，将补充 CI/CD 使用说明与常见问题排查清单。

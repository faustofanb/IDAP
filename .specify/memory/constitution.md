# 项目宪章：智能数据询问平台

> 版本：v1.0（2025-10-26）

本宪章定义项目的治理原则、工程准则与交付节奏。所有规格、计划、任务与实现活动必须遵照本宪章执行；如需调整，须经产品、工程与数据干系人共同批准。

## 第一条 规范优先

- `.specify/` 目录内的规格、计划、任务与契约文档是唯一事实来源（Source of Truth）。
- 文档与实现必须保持可追溯关系：代码、脚本与测试需指向对应的规格条款或任务编号。

## 第二条 价值导向

- 每个功能需记录对分析师与运营人员的可量化价值指标。
- 模糊需求须以 `[NEEDS CLARIFICATION: ...]` 标注，并在实施计划批准前关闭。

## 第三条 测试驱动

- 编写实现前，需先完成自动化测试、API/事件契约及握手场景。
- 未具备可演示的单元、集成与契约测试覆盖的任务不得关闭。

## 第四条 架构护栏

- **前端基座**：基于 Plus-Vben5 框架（Vue 3 + TypeScript + Vite + Pinia），组件库选用 Ant Design Vue；核心交互通过 WebSocket，REST 仅作为补充渠道。
- **后端基座**：采用 RuoYi-Vue-Plus（Java 21 + Spring Boot 3 + Undertow + MyBatis-Plus + Sa-Token），启用 Redis/Redisson、dynamic-datasource、HikariCP、SpringDoc、SnailJob、MinIO 与 Jackson 等配套组件。
- **AI 服务**：独立 FastAPI + LangChain + LangGraph 服务，仅输出结构化请求，不直接访问数据库或执行 SQL。
- 服务间通信统一使用结构化 JSON，必须携带 `correlationId` 与遥测字段。

## 第五条 CQRS 与事件规范

- 在规格、计划与代码中明确区分命令与查询职责。
- 事件驱动集成需记录生产者、消费者、消息格式、投递保证与重放策略。

## 第六条 安全与合规

- 所有外部交互需通过 JWT 认证，并在多端间维持一致的权限模型。
- 每个功能需声明 PII 处理与审计需求，并在规划阶段完成验证。

## 第七条 性能目标

- 规格文档需给出 API、WebSocket 与 AI 往返的 p95 延迟与期望吞吐。
- 计划文档需描述满足性能目标的并发策略（如虚拟线程池、异步流程或流控）。

## 第八条 可观测性

- 为每个功能定义日志、追踪与指标方案，覆盖跨服务请求关联。
- 计划文档需列出验证可观测性的脚本或测试步骤。

## 第九条 变更管理

- 宪章的任何修改需记录变更理由与影响分析。
- 任务完成后，必须同步更新 `.specify/specs/<feature>/plan.md` 与 `.specify/specs/<feature>/tasks.md`，并在提交信息与文档“更新记录”中注明日期与要点。

## 第十条 文档规约

- 通用说明性文档集中于 `docs/`，规格、计划、任务与契约文档统一存放于 `.specify/specs/`；全部采用简体中文，若需英文术语，使用“中文（English）”格式注记。
- 根目录 `docs/` 承载全局架构与规约，具体实现手册分别归档于 `frontend/docs/`、`backend/docs/`、`ai/docs/`，并可引用 `.specify/specs/` 中的规范作为依据。
- 新增文档需使用两位数字前缀排序，同级文档按数字升序排列。

## 第十一条 业务域与多租户

- 系统定位为多租户进销存后台管理平台，租户隔离是所有功能的基础假设。
- 核心业务模块：租户管理、机构管理、用户管理、菜单与 URL 管理、权限管理、报表展示及进销存业务流程。
- 所有读写必须显式携带 `tenantId`；默认禁止跨租户访问，运营特权操作需审批并记录不可篡改审计日志。

## 第十二条 AI 能力约束

- AI 功能范围限定为“进销存智能数据查询”与“报表洞察”。
- AI 服务不得直接执行 SQL，仅生成查询意图或中间表示，由受控查询层访问数据；输出必须附带遥测与来源说明。

## 更新记录

- 2025-10-26：初始化宪章，补充 Vben5 + Ant Design Vue 前端基座、RuoYi-Vue-Plus 后端基座与规格驱动开发依赖。
